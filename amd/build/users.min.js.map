{"version":3,"file":"users.min.js","sources":["../src/users.js"],"sourcesContent":["import Templates from \"core/templates\";\r\nimport Utils from 'local_certificate_management/utils';\r\nimport Repository from 'local_certificate_management/repository';\r\n\r\nconst getParams = async root => {\r\n    return {\r\n        courseId: Number(root.attr('data-courseid')),\r\n        limit: Number(root.attr('data-limit')),\r\n        page: Number(root.attr('data-page')),\r\n        search: root.find('#search-param').val() || '',\r\n        sort: root.find('#order-param').val() || '',\r\n    };\r\n}\r\n\r\nconst usersComponents = {\r\n    notFound: 'local_certificate_management/components/users/table-row-not-found',\r\n    empty: 'local_certificate_management/components/users/table-row-empty',\r\n    content: 'local_certificate_management/components/users/table-row'\r\n}\r\n\r\nconst loadUsers = async (root, seeMore = false) => {\r\n    try {\r\n        const params = await getParams(root);\r\n        const data = await Repository.retrieveUsers(params);\r\n\r\n        let templateToLoad = usersComponents.content;\r\n\r\n        if (!seeMore && !data.users.length && !params.search) {\r\n            templateToLoad = usersComponents.empty;\r\n        }\r\n\r\n        if (!seeMore && !data.users.length && params.search) {\r\n            Utils.disableButton(root);\r\n            templateToLoad = usersComponents.notFound;\r\n        }\r\n\r\n        if (!seeMore) {\r\n            root.find('.users-content').empty();\r\n            root.find('.total-users').text(0);\r\n        }\r\n\r\n        const html = await Templates.render(templateToLoad, {users: data.users});\r\n\r\n        root.find('.total-users').text(data.total)\r\n\r\n        root.find('.users-content').append(html);\r\n\r\n        const coursesLength = root.find('.users-item').length;\r\n\r\n        if (data.total === coursesLength) {\r\n            Utils.disableButton(root);\r\n        } else if (root.find('.see_more').hasClass('hidden') && data.total > coursesLength) {\r\n            Utils.activeButton(root);\r\n        }\r\n    } catch (error) {\r\n        console.log(error);\r\n        root.find('.users-content').empty();\r\n        root.find('.total-users').text(0);\r\n        const html = await Templates.render(usersComponents.empty, {});\r\n        Utils.disableButton(root);\r\n        root.find('.users-content').append(html);\r\n    }\r\n\r\n}\r\n\r\nconst init = async root => {\r\n    await loadUsers(root);\r\n\r\n    let timeout;\r\n    root.find('#search-param').on('keyup', e => {\r\n\r\n        clearTimeout(timeout);\r\n\r\n        timeout = setTimeout(async () => {\r\n            await loadUsers(root);\r\n        }, 2000);\r\n    });\r\n\r\n    root.find('#order-param').on('change', async event => {\r\n        await loadUsers(root);\r\n    });\r\n\r\n    root.find('.see_more').on('click', async function () {\r\n        const newPage = Number(root.attr('data-page')) + 1;\r\n        root.attr('data-page', newPage);\r\n        await loadUsers(root, true);\r\n    });\r\n}\r\n\r\nexport default {\r\n    init\r\n};"],"names":["getParams","async","courseId","Number","root","attr","limit","page","search","find","val","sort","usersComponents","loadUsers","seeMore","params","data","Repository","retrieveUsers","templateToLoad","users","length","disableButton","empty","text","html","Templates","render","total","append","coursesLength","hasClass","activeButton","error","console","log","init","timeout","on","e","clearTimeout","setTimeout","newPage"],"mappings":"sfAIMA,UAAYC,MAAAA,OACP,CACHC,SAAUC,OAAOC,KAAKC,KAAK,kBAC3BC,MAAOH,OAAOC,KAAKC,KAAK,eACxBE,KAAMJ,OAAOC,KAAKC,KAAK,cACvBG,OAAQJ,KAAKK,KAAK,iBAAiBC,OAAS,GAC5CC,KAAMP,KAAKK,KAAK,gBAAgBC,OAAS,KAI3CE,yBACQ,oEADRA,sBAEK,gEAFLA,wBAGO,0DAGPC,UAAYZ,eAAOG,UAAMU,0EAEjBC,aAAef,UAAUI,MACzBY,WAAaC,oBAAWC,cAAcH,YAExCI,eAAiBP,wBAEhBE,SAAYE,KAAKI,MAAMC,QAAWN,OAAOP,SAC1CW,eAAiBP,uBAGhBE,SAAYE,KAAKI,MAAMC,SAAUN,OAAOP,wBACnCc,cAAclB,MACpBe,eAAiBP,0BAGhBE,UACDV,KAAKK,KAAK,kBAAkBc,QAC5BnB,KAAKK,KAAK,gBAAgBe,KAAK,UAG7BC,WAAaC,mBAAUC,OAAOR,eAAgB,CAACC,MAAOJ,KAAKI,QAEjEhB,KAAKK,KAAK,gBAAgBe,KAAKR,KAAKY,OAEpCxB,KAAKK,KAAK,kBAAkBoB,OAAOJ,YAE7BK,cAAgB1B,KAAKK,KAAK,eAAeY,OAE3CL,KAAKY,QAAUE,6BACTR,cAAclB,MACbA,KAAKK,KAAK,aAAasB,SAAS,WAAaf,KAAKY,MAAQE,8BAC3DE,aAAa5B,MAEzB,MAAO6B,OACLC,QAAQC,IAAIF,OACZ7B,KAAKK,KAAK,kBAAkBc,QAC5BnB,KAAKK,KAAK,gBAAgBe,KAAK,SACzBC,WAAaC,mBAAUC,OAAOf,sBAAuB,mBACrDU,cAAclB,MACpBA,KAAKK,KAAK,kBAAkBoB,OAAOJ,qBA6B5B,CACXW,KAzBSnC,MAAAA,WAGLoC,cAFExB,UAAUT,MAGhBA,KAAKK,KAAK,iBAAiB6B,GAAG,SAASC,IAEnCC,aAAaH,SAEbA,QAAUI,YAAWxC,gBACXY,UAAUT,QACjB,QAGPA,KAAKK,KAAK,gBAAgB6B,GAAG,UAAUrC,MAAAA,cAC7BY,UAAUT,SAGpBA,KAAKK,KAAK,aAAa6B,GAAG,SAASrC,uBACzByC,QAAUvC,OAAOC,KAAKC,KAAK,cAAgB,EACjDD,KAAKC,KAAK,YAAaqC,eACjB7B,UAAUT,MAAM"}