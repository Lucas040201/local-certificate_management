{"version":3,"file":"course.min.js","sources":["../src/course.js"],"sourcesContent":["import Repository from 'local_certificate_management/repository';\r\nimport Templates from \"core/templates\";\r\n\r\nconst getParams = async root => {\r\n    return {\r\n        limit: Number(root.attr('data-limit')),\r\n        page: Number(root.attr('data-page')),\r\n        search: root.find('#search-param').val() || '',\r\n        sort: root.find('#order-param').val() || '',\r\n    };\r\n}\r\n\r\nconst courseComponents = {\r\n    notFound: 'local_certificate_management/components/course/table-row-not-found',\r\n    empty: 'local_certificate_management/components/course/table-row-empty',\r\n    content: 'local_certificate_management/components/course/table-row'\r\n}\r\n\r\nconst loadCourses = async (root, seeMore = false) => {\r\n    try {\r\n        const params = await getParams(root);\r\n        const data = await Repository.retrieveCourses(params);\r\n\r\n        let templateToLoad = courseComponents.content;\r\n\r\n        if (!seeMore && !data.courses.length && !params.search) {\r\n            templateToLoad = courseComponents.empty;\r\n        }\r\n\r\n        if (!seeMore && !data.courses.length && params.search) {\r\n            disableButton(root);\r\n            templateToLoad = courseComponents.notFound;\r\n        }\r\n\r\n        if (!seeMore) {\r\n            root.find('.courses-content').empty();\r\n            root.find('.total-courses').text(0);\r\n        }\r\n\r\n        const html = await Templates.render(templateToLoad, {courses: data.courses});\r\n\r\n        root.find('.total-courses').text(data.total)\r\n\r\n        root.find('.courses-content').append(html);\r\n\r\n        const coursesLength = root.find('.courses-item').length;\r\n\r\n        if (data.total === coursesLength) {\r\n            disableButton(root);\r\n        } else if (root.find('.see_more').hasClass('hidden') && data.total > coursesLength) {\r\n            activeButton(root);\r\n        }\r\n    } catch (error) {\r\n        root.find('.courses-content').empty();\r\n        root.find('.total-courses').text(0);\r\n        const html = await Templates.render(courseComponents.empty, {});\r\n        disableButton(root);\r\n        root.find('.courses-content').append(html);\r\n    }\r\n\r\n}\r\n\r\nfunction disableButton(root, findClass = 'see_more') {\r\n    root.find(`.${findClass}`).addClass('hidden');\r\n    root.find(`.${findClass}`).attr('disabled', true);\r\n}\r\n\r\nfunction activeButton(root, findClass = 'see_more') {\r\n    root.find(`.${findClass}`).removeClass('hidden');\r\n    root.find(`.${findClass}`).attr('disabled', false);\r\n}\r\n\r\nconst init = async root => {\r\n    await loadCourses(root);\r\n\r\n    let timeout;\r\n    root.find('#search-param').on('keyup', e => {\r\n\r\n        clearTimeout(timeout);\r\n\r\n        timeout = setTimeout(async () => {\r\n            await loadCourses(root);\r\n        }, 2000);\r\n    });\r\n\r\n    root.find('#order-param').on('change', async event => {\r\n       await loadCourses(root);\r\n    });\r\n\r\n    root.find('.see_more').on('click', async function () {\r\n        const newPage = Number(root.attr('data-page')) + 1;\r\n        root.attr('data-page', newPage);\r\n        await loadCourses(root, true);\r\n    });\r\n}\r\n\r\nexport default {\r\n    init\r\n};"],"names":["getParams","async","limit","Number","root","attr","page","search","find","val","sort","courseComponents","loadCourses","seeMore","params","data","Repository","retrieveCourses","templateToLoad","courses","length","disableButton","empty","text","html","Templates","render","total","append","coursesLength","hasClass","activeButton","error","findClass","addClass","removeClass","init","timeout","on","e","clearTimeout","setTimeout","newPage"],"mappings":"qaAGMA,UAAYC,MAAAA,OACP,CACHC,MAAOC,OAAOC,KAAKC,KAAK,eACxBC,KAAMH,OAAOC,KAAKC,KAAK,cACvBE,OAAQH,KAAKI,KAAK,iBAAiBC,OAAS,GAC5CC,KAAMN,KAAKI,KAAK,gBAAgBC,OAAS,KAI3CE,0BACQ,qEADRA,uBAEK,iEAFLA,yBAGO,2DAGPC,YAAcX,eAAOG,UAAMS,0EAEnBC,aAAed,UAAUI,MACzBW,WAAaC,oBAAWC,gBAAgBH,YAE1CI,eAAiBP,yBAEhBE,SAAYE,KAAKI,QAAQC,QAAWN,OAAOP,SAC5CW,eAAiBP,wBAGhBE,SAAYE,KAAKI,QAAQC,SAAUN,OAAOP,SAC3Cc,cAAcjB,MACdc,eAAiBP,2BAGhBE,UACDT,KAAKI,KAAK,oBAAoBc,QAC9BlB,KAAKI,KAAK,kBAAkBe,KAAK,UAG/BC,WAAaC,mBAAUC,OAAOR,eAAgB,CAACC,QAASJ,KAAKI,UAEnEf,KAAKI,KAAK,kBAAkBe,KAAKR,KAAKY,OAEtCvB,KAAKI,KAAK,oBAAoBoB,OAAOJ,YAE/BK,cAAgBzB,KAAKI,KAAK,iBAAiBY,OAE7CL,KAAKY,QAAUE,cACfR,cAAcjB,MACPA,KAAKI,KAAK,aAAasB,SAAS,WAAaf,KAAKY,MAAQE,eACjEE,aAAa3B,MAEnB,MAAO4B,OACL5B,KAAKI,KAAK,oBAAoBc,QAC9BlB,KAAKI,KAAK,kBAAkBe,KAAK,SAC3BC,WAAaC,mBAAUC,OAAOf,uBAAwB,IAC5DU,cAAcjB,MACdA,KAAKI,KAAK,oBAAoBoB,OAAOJ,iBAKpCH,cAAcjB,UAAM6B,iEAAY,WACrC7B,KAAKI,gBAASyB,YAAaC,SAAS,UACpC9B,KAAKI,gBAASyB,YAAa5B,KAAK,YAAY,YAGvC0B,aAAa3B,UAAM6B,iEAAY,WACpC7B,KAAKI,gBAASyB,YAAaE,YAAY,UACvC/B,KAAKI,gBAASyB,YAAa5B,KAAK,YAAY,gBA2BjC,CACX+B,KAzBSnC,MAAAA,WAGLoC,cAFEzB,YAAYR,MAGlBA,KAAKI,KAAK,iBAAiB8B,GAAG,SAASC,IAEnCC,aAAaH,SAEbA,QAAUI,YAAWxC,gBACXW,YAAYR,QACnB,QAGPA,KAAKI,KAAK,gBAAgB8B,GAAG,UAAUrC,MAAAA,cAC9BW,YAAYR,SAGrBA,KAAKI,KAAK,aAAa8B,GAAG,SAASrC,uBACzByC,QAAUvC,OAAOC,KAAKC,KAAK,cAAgB,EACjDD,KAAKC,KAAK,YAAaqC,eACjB9B,YAAYR,MAAM"}